version: "3.3"

services:
  openappsec-agent:
    image: ghcr.io/openappsec/agent:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./conf:/etc/cp/conf
      - ./data:/etc/cp/data
      - ./logs:/var/log/nano_agent
      - ./advanced-model/open-appsec-advanced-model.tgz:/advanced-model/open-appsec-advanced-model.tgz:rw
    environment:
      - CROWDSEC_ENABLED=true
      - CROWDSEC_MODE=prevent
      - CROWDSEC_LOGGING=enabled
      - CROWDSEC_API_URL=http://crowdsec:8080/v1/decisions/stream
      - CROWDSEC_AUTH_METHOD=apikey
      - CROWDSEC_AUTH_DATA=LAPI_CROWDSEC_BOUNCER_KEY
    command: /cp-nano-agent --token OPENAPPSEC_TOKEN
    networks:
      - traefik-network

networks:
  traefik-network:
    external: true
